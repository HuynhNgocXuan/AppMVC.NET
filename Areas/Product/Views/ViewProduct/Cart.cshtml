@model List<webMVC.Areas.Product.Models.CartItem>
@{
  Layout = "_Layout";
}
<h2>GIỎ HÀNG</h2>

@if (Model.Count > 0)
{
  decimal total = 0;

  <table class="table">
    <tr>
      <th></th>
      <th>Sản phẩm</th>
      <th>Giá</th>
      <th>Số lượng</th>
      <th>Thành tiền</th>
      <th></th>
    </tr>
    @foreach (var cartItem in Model)
    {
      var intoMoney = cartItem.quantity * cartItem.product.Price;
      total += intoMoney;

      <tr>
        <td><input type="checkbox"></td>
        <td>@cartItem.product.Title</td>
        <td>@(cartItem.product.Price.ToString("n0"))</td>
        <td>
          <button class="border-1">-</button>
          <input type="text" class="quantityProduct text-center" asp-for="@cartItem.quantity"
            id="@($"quantity-{cartItem.product.ProductID}")" />
          <button class="border-1">+</button>
        </td>
        <td>@(intoMoney.ToString("n0"))</td>
        <td>
          <button class="btn btn-success updateCartItem" data-productId="@cartItem.product.ProductID">Cập nhật</button>
          <a asp-route="removeCart" asp-route-productId="@cartItem.product.ProductID" class="btn btn-danger">Xóa</a>
        </td>
      </tr>
    }
    <tr>
      <td colspan="4" class="text-right">Tổng tiền</td>
      <td>@(total.ToString("n0"))</td>
      <td></td>
    </tr>
  </table>

  <a asp-controller="ViewProduct" asp-action="Checkout" class="btn btn-success">Gửi đơn hàng</a>

  @section Scripts {
  <script>
    $(document).ready(function () {
      $(".updateCartItem").click(function (event) {
        event.preventDefault();
        var productId = $(this).attr("data-productId");
        var quantity = $("#quantity-" + productId).val();
        $.ajax({
          type: "POST",
          url: "@Url.RouteUrl("updateCart")",
          data: {
            productId: productId,
            quantity: quantity
          },
          success: function (result) {
            window.location.href = "@Url.RouteUrl("cart")";
          }
        });
      });
    });
  </script>
  }
}


else
{
  <div class="d-flex flex-column align-items-center justify-content-center" style="height: 300px;">
    <div>
      ***_***
    </div>
    <div class="fs-5 text-warning">Giỏ hàng của bạn đang trống</div>
    <a asp-action="Index"
      class="mt-3 bg-danger text-light  py-2 px-3 rounded fs-5">Mua ngay</a>
  </div>
}