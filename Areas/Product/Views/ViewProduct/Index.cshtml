@model List<ProductModel>
@using webMVC.Components;

@{ 
    List<CategoryProduct>? categories = ViewBag.categories as List<CategoryProduct>;
    CategoryProduct? category = ViewBag.category as CategoryProduct;  
    ViewData["Title"] = (category != null) ? category.Title : 
                        "Tất cả sản phẩm";
}

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    @if  (category != null)
    {
        var li = category.ListParents();
        foreach (var l in li)
        {
            <li class="breadcrumb-item">
                <a asp-action="Index" asp-route-categorySlug="@l.Slug">@l.Title</a>
            </li>
        }
    } 
  </ol>
</nav>



<h2>@ViewData["Title"]</h2>
<hr>

<div class="d-flex flex-wrap justify-content-between">
    @foreach (var product in Model)
    {
        var srcImg = "/contents/noPhoto.png";
        if (product.Photos!.Any())
        {
            srcImg = $"/contents/Products/{product.Photos!.FirstOrDefault()!.FileName}";
        }

        <div class="product-card">
            <a asp-controller="ViewProduct" asp-action="Detail" asp-route-productSlug="@product.Slug">
                <img src="@srcImg" class="card-img-top product-image" alt="...">
                <div class="card-body pb-0">
                    <h5 class="card-title product-title">@product.Title</h5>
                    <text>Giá: <strong>@product.Price</strong></text>
                </div>
                <div class="card-body pt-0">
                    <small>Vị trí đang bán ở đâu</small>
                    <small>Đã bán: 5K</small>
                    <small>5*</small>
                </div>
            </a>
        </div>
    }
</div>

@section Sidebar {
    @await Component.InvokeAsync("webMVC.Components.CategoryProductSidebar", 
        new CategoryProductSidebar.CategorySidebarData()
        {
            Categories = categories,
            level = 0,
            categorySlug = ViewBag.categorySlug
        })
}


<partial name="_PagingXTL" model="@ViewBag.pagingModel" />